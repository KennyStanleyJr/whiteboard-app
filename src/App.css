/* Stacking: .app-overlay z-100, .app-header z-110; whiteboard UI stays below. */
/* .app-overlay-bg inside overlay is the management background; it animates in/out with the overlay (same element). */
.app-overlay {
  position: fixed;
  inset: 0;
  z-index: 100;
  overflow: visible;
  clip-path: none;
  transition:
    opacity var(--viewport-transition-duration) var(--viewport-transition-easing),
    visibility 0s linear var(--viewport-transition-duration);
}

.app-overlay.visible {
  transition:
    opacity var(--viewport-transition-duration) var(--viewport-transition-easing),
    visibility 0s linear 0s;
}

/* Management page: theme text; background comes from .app-overlay-bg child */
.dark .app-overlay {
  color: var(--color-foreground);
}

.app-header {
  z-index: 110;
  pointer-events: none;
  transition: color 0.2s ease;
  background-color: transparent;
}
.app-header > * {
  pointer-events: auto;
}

/* Header board name input: no visible background */
.app-header .header-input,
.dark .app-header .header-input {
  background-color: transparent;
}

/* Header contrast "dark" = dark text (light canvas or light theme on management) */
.app-header[data-header-contrast="dark"] {
  color: oklch(0.2 0 0);
}
.app-header[data-header-contrast="dark"] .header-input,
.app-header[data-header-contrast="dark"] .header-input::placeholder {
  color: inherit;
}
.app-header[data-header-contrast="dark"] .management-toggle-button span {
  border-color: rgba(0, 0, 0, 0.4);
}

/* Header contrast "light" = light text (dark canvas or dark theme on management) */
.app-header[data-header-contrast="light"] {
  color: #e8e8e8;
}
.app-header[data-header-contrast="light"] .header-input,
.app-header[data-header-contrast="light"] .header-input::placeholder {
  color: inherit;
}
.app-header[data-header-contrast="light"] .management-toggle-button span {
  border-color: rgba(255, 255, 255, 0.55);
}

/* Management and hamburger buttons always use theme foreground (same as toolbars) */
.management-toggle-button,
.management-toggle-button span,
.app-menu-button {
  color: var(--color-foreground) !important;
}
.management-toggle-button span {
  border-color: var(--color-foreground) !important;
}
/* Menu dropdown always uses theme (light/dark mode) colors, not canvas contrast */
.app-header[data-header-contrast="dark"] .app-menu-dropdown,
.app-header[data-header-contrast="light"] .app-menu-dropdown {
  color: var(--color-foreground);
}
.app-header[data-header-contrast="dark"] .app-menu-dropdown .text-muted-foreground,
.app-header[data-header-contrast="light"] .app-menu-dropdown .text-muted-foreground {
  color: var(--color-muted-foreground);
}
/* Grid style selector in menu: match toolbar colors (background, border, hover, selected) */
.app-menu-dropdown .grid-style-selector {
  background-color: var(--color-background);
  border: 1px solid var(--color-border);
}
.dark .app-menu-dropdown .grid-style-selector {
  background-color: oklch(0.205 0 0) !important;
  border-color: oklch(0.35 0 0);
}
.app-menu-dropdown .grid-style-btn {
  color: var(--color-foreground);
}
.app-menu-dropdown .grid-style-btn:hover {
  background-color: var(--toolbar-hover-bg);
  color: var(--toolbar-hover-fg);
}
.app-menu-dropdown .grid-style-btn--selected {
  background-color: oklch(0.88 0 0) !important;
  color: oklch(0.2 0 0) !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
}
.dark .app-menu-dropdown .grid-style-btn--selected {
  background-color: oklch(0.3 0 0) !important;
  color: oklch(0.95 0 0) !important;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25);
}
/* Whiteboard canvas and text elements (SVG/foreignObject-specific) */

.whiteboard-canvas-wrap {
  position: relative;
  flex: 1;
  min-height: 0;
  overflow: hidden;
  touch-action: none;
}

.whiteboard-canvas-wrap.is-dragging,
.whiteboard-canvas-wrap.is-resizing {
  user-select: none;
}

.whiteboard-canvas-wrap:focus {
  outline: none;
}

/* Shared hover for menus, toolbars, management – subtle and consistent */
:root {
  --toolbar-hover-bg: oklch(0.93 0 0);
  --toolbar-hover-fg: oklch(0.25 0 0);
  --card-menu-button-hover-bg: oklch(0.88 0 0); /* darker than card so button stands out */
}
.dark {
  --toolbar-hover-bg: oklch(0.28 0 0);
  --toolbar-hover-fg: oklch(0.95 0 0);
  --card-menu-button-hover-bg: oklch(0.35 0 0); /* lighter than card so button stands out */
}

/* Both toolbars: same background, foreground, and border in light and dark mode */
.whiteboard-toolbar,
.selection-toolbar {
  outline: none;
  background-color: var(--color-background) !important;
  color: var(--color-foreground);
  border-color: var(--color-border);
}
.dark .whiteboard-toolbar,
.dark .selection-toolbar {
  background-color: oklch(0.205 0 0) !important;
  border-color: oklch(0.35 0 0);
}
.whiteboard-toolbar button {
  background-color: transparent;
  border: none;
}
.whiteboard-toolbar button:not(:disabled):not(.destructive-menu-item):hover,
.selection-toolbar button:not(:disabled):not(.destructive-menu-item):hover {
  background-color: var(--toolbar-hover-bg);
  color: var(--toolbar-hover-fg);
  border-radius: 0.5rem;
}
.selection-toolbar button[aria-pressed="true"] {
  background-color: oklch(0.88 0 0) !important;
  color: oklch(0.2 0 0) !important;
  border-radius: 0.5rem;
}
.dark .selection-toolbar button[aria-pressed="true"] {
  background-color: oklch(0.3 0 0) !important;
  color: oklch(0.95 0 0) !important;
}
.selection-toolbar input {
  color: var(--color-foreground);
}
.selection-toolbar input::placeholder {
  color: var(--color-muted-foreground);
}
/* Font size control: blend with toolbar (no dark container/input background, buttons transparent) */
.selection-toolbar .font-size-control {
  background-color: transparent;
}
.selection-toolbar .font-size-control input,
.selection-toolbar .font-size-control button,
.selection-toolbar .font-size-control [data-slot="select-trigger"] {
  background-color: transparent !important;
}

/* Header toolbar buttons: management and hamburger – same background/border as toolbars */
.management-toggle-button,
.app-menu-button {
  background-color: var(--color-background);
  border: 1px solid var(--color-border);
}
.dark .management-toggle-button,
.dark .app-menu-button {
  background-color: oklch(0.205 0 0) !important;
  border-color: oklch(0.35 0 0);
}
.management-toggle-button:not(:disabled):hover,
.app-menu-button:not(:disabled):hover {
  background-color: oklch(0.85 0 0) !important;
  color: oklch(0.25 0 0) !important;
  border-radius: 0.5rem;
}
.dark .management-toggle-button:not(:disabled):hover,
.dark .app-menu-button:not(:disabled):hover {
  background-color: oklch(0.35 0 0) !important;
  color: oklch(0.95 0 0) !important;
}

/* Board card wrapper - sized to allow scale transform without clipping */
.board-card-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: visible;
}

/* Management page cards: theme-aware text in dark mode (override Tailwind utilities) */
.dark .app-overlay .board-card-wrapper,
.dark .app-overlay .board-card-wrapper span,
.dark .app-overlay .board-card-wrapper button:not(.destructive-menu-item),
.dark .app-overlay .board-card-wrapper input {
  color: var(--color-foreground) !important;
}
/* Destructive menu item (Delete): card menu + selection toolbar context menus */
.destructive-menu-item,
.destructive-menu-item span,
.destructive-menu-item [class*="size-4"],
.destructive-menu-item svg {
  color: var(--color-destructive) !important;
}
.destructive-menu-item:hover {
  background-color: oklch(0.577 0.245 27.325 / 0.1) !important;
}
.destructive-menu-item:hover,
.destructive-menu-item:hover span,
.destructive-menu-item:hover svg {
  color: var(--color-destructive) !important;
}
/* Override theme so Delete stays red where theme forces foreground color */
.dark .app-overlay .board-card-wrapper .destructive-menu-item,
.dark .app-overlay .board-card-wrapper .destructive-menu-item span,
.dark .app-overlay .board-card-wrapper .destructive-menu-item svg,
.selection-toolbar .destructive-menu-item,
.selection-toolbar .destructive-menu-item span,
.selection-toolbar .destructive-menu-item svg {
  color: var(--color-destructive) !important;
}
.dark .app-overlay .board-card-wrapper .destructive-menu-item:hover,
.dark .app-overlay .board-card-wrapper .destructive-menu-item:hover span,
.dark .app-overlay .board-card-wrapper .destructive-menu-item:hover svg,
.selection-toolbar .destructive-menu-item:hover,
.selection-toolbar .destructive-menu-item:hover span,
.selection-toolbar .destructive-menu-item:hover svg {
  color: var(--color-destructive) !important;
}

/* Dark mode: less saturated red for both delete buttons */
.dark .destructive-menu-item,
.dark .destructive-menu-item span,
.dark .destructive-menu-item [class*="size-4"],
.dark .destructive-menu-item svg,
.dark .app-overlay .board-card-wrapper .destructive-menu-item,
.dark .app-overlay .board-card-wrapper .destructive-menu-item span,
.dark .app-overlay .board-card-wrapper .destructive-menu-item svg,
.dark .selection-toolbar .destructive-menu-item,
.dark .selection-toolbar .destructive-menu-item span,
.dark .selection-toolbar .destructive-menu-item svg {
  color: var(--destructive-menu-item-dark) !important;
}
.dark .destructive-menu-item:hover,
.dark .destructive-menu-item:hover span,
.dark .destructive-menu-item:hover svg,
.dark .app-overlay .board-card-wrapper .destructive-menu-item:hover,
.dark .app-overlay .board-card-wrapper .destructive-menu-item:hover span,
.dark .app-overlay .board-card-wrapper .destructive-menu-item:hover svg,
.dark .selection-toolbar .destructive-menu-item:hover,
.dark .selection-toolbar .destructive-menu-item:hover span,
.dark .selection-toolbar .destructive-menu-item:hover svg {
  color: var(--destructive-menu-item-dark) !important;
}
.dark .destructive-menu-item:hover {
  background-color: color-mix(in oklch, var(--destructive-menu-item-dark) 15%, transparent) !important;
}

/* Management page cards: simple hover, no inner outline from button */
.app-overlay .board-card-wrapper > div > button:first-of-type:hover {
  background-color: transparent;
}
/* Card hover: same as Import/Download All (toolbar hover, border unchanged) */
.app-overlay .board-card-wrapper > div:hover {
  background-color: var(--toolbar-hover-bg);
  color: var(--toolbar-hover-fg);
}
.app-overlay .board-card-wrapper > div:hover span {
  color: inherit;
}

/* New Whiteboard: more prominent hover (default primary/90 is too subtle) */
.app-overlay .management-new-board-btn:not(:disabled):hover {
  background-color: oklch(0.32 0 0) !important;
  color: oklch(0.985 0 0) !important;
}
.dark .app-overlay .management-new-board-btn:not(:disabled):hover {
  background-color: oklch(0.75 0 0) !important;
  color: oklch(0.2 0 0) !important;
}

/* Upload and Download All: border matches whiteboard cards, hover same as toolbar */
.app-overlay .management-upload-download-btn,
.app-overlay .management-upload-download-btn:hover {
  border-color: var(--border) !important;
}
.app-overlay .management-upload-download-btn:not(:disabled):hover {
  background-color: var(--toolbar-hover-bg) !important;
  color: var(--toolbar-hover-fg) !important;
}

/* Portaled dialogs: explicit light/dark so they match theme when rendered outside themed root */
.image-info-dialog .image-info-dialog__title {
  color: oklch(0.145 0 0) !important;
}
.image-info-dialog .image-info-dialog__optimize-btn {
  border: 1px solid var(--border) !important;
  background-color: var(--background) !important;
  color: var(--foreground) !important;
}
.image-info-dialog .image-info-dialog__optimize-btn:hover:not(:disabled) {
  background-color: var(--toolbar-hover-bg) !important;
  color: var(--toolbar-hover-fg) !important;
}
.image-info-dialog.dark .image-info-dialog__title {
  color: oklch(0.985 0 0) !important;
}
.image-info-dialog.dark dt,
.image-info-dialog.dark .text-muted-foreground {
  color: oklch(0.708 0 0) !important;
}
.image-info-dialog.dark dd,
.image-info-dialog.dark .text-foreground {
  color: oklch(0.985 0 0) !important;
}
.image-info-dialog.dark > button {
  color: oklch(0.985 0 0) !important;
}
.image-info-dialog.dark > button:hover {
  opacity: 1;
}
.image-info-dialog.dark,
.import-image-options-dialog.dark,
.upload-warning-dialog.dark,
.delete-whiteboard-dialog.dark {
  background-color: oklch(0.145 0 0) !important;
  color: oklch(0.985 0 0) !important;
  border-color: oklch(1 0 0 / 10%) !important;
}
.image-info-dialog.dark .image-info-dialog__optimize-btn {
  background-color: oklch(0.205 0 0) !important;
  border-color: oklch(1 0 0 / 25%) !important;
  color: oklch(0.985 0 0) !important;
}
.image-info-dialog.dark .image-info-dialog__optimize-btn:hover:not(:disabled) {
  background-color: oklch(0.269 0 0) !important;
  border-color: oklch(1 0 0 / 35%) !important;
  color: oklch(0.985 0 0) !important;
}
.import-image-options-dialog .import-image-options-dialog__title {
  color: oklch(0.145 0 0) !important;
}
.import-image-options-dialog.dark .import-image-options-dialog__title {
  color: oklch(0.985 0 0) !important;
}

/* Upload (add content) dialog: same portaled styling */
.upload-warning-dialog .upload-warning-dialog__title {
  color: oklch(0.145 0 0) !important;
}
.upload-warning-dialog.dark .upload-warning-dialog__title {
  color: oklch(0.985 0 0) !important;
}
.upload-warning-dialog.dark .text-muted-foreground {
  color: oklch(0.708 0 0) !important;
}
.upload-warning-dialog .upload-warning-dialog__replace {
  border-color: var(--border) !important;
}
.upload-warning-dialog .upload-warning-dialog__replace:hover:not(:disabled),
.upload-warning-dialog .upload-warning-dialog__cancel:hover:not(:disabled) {
  background-color: var(--toolbar-hover-bg) !important;
  color: var(--toolbar-hover-fg) !important;
}
.upload-warning-dialog.dark .upload-warning-dialog__replace {
  background-color: oklch(0.205 0 0) !important;
  border-color: oklch(1 0 0 / 25%) !important;
  color: oklch(0.985 0 0) !important;
}
.upload-warning-dialog.dark .upload-warning-dialog__replace:hover:not(:disabled),
.upload-warning-dialog.dark .upload-warning-dialog__cancel:hover:not(:disabled) {
  background-color: oklch(0.269 0 0) !important;
  color: oklch(0.985 0 0) !important;
}
.upload-warning-dialog.dark .upload-warning-dialog__replace:hover:not(:disabled) {
  border-color: oklch(1 0 0 / 35%) !important;
}
.upload-warning-dialog.dark > button {
  color: oklch(0.985 0 0) !important;
}
.upload-warning-dialog.dark > button:hover {
  opacity: 1;
}

/* Delete whiteboard dialog: same portaled styling */
.delete-whiteboard-dialog .delete-whiteboard-dialog__title {
  color: oklch(0.145 0 0) !important;
}
.delete-whiteboard-dialog.dark .delete-whiteboard-dialog__title {
  color: oklch(0.985 0 0) !important;
}
.delete-whiteboard-dialog.dark .text-muted-foreground {
  color: oklch(0.708 0 0) !important;
}
.delete-whiteboard-dialog .delete-whiteboard-dialog__cancel {
  border-color: var(--border) !important;
}
.delete-whiteboard-dialog .delete-whiteboard-dialog__cancel:hover:not(:disabled) {
  background-color: var(--toolbar-hover-bg) !important;
  color: var(--toolbar-hover-fg) !important;
}
.delete-whiteboard-dialog.dark .delete-whiteboard-dialog__cancel {
  background-color: oklch(0.205 0 0) !important;
  border-color: oklch(1 0 0 / 25%) !important;
  color: oklch(0.985 0 0) !important;
}
.delete-whiteboard-dialog.dark .delete-whiteboard-dialog__cancel:hover:not(:disabled) {
  background-color: oklch(0.269 0 0) !important;
  color: oklch(0.985 0 0) !important;
}
.delete-whiteboard-dialog.dark .delete-whiteboard-dialog__confirm {
  background-color: oklch(0.55 0.2 25) !important;
  border-color: oklch(0.55 0.2 25) !important;
  color: oklch(0.985 0 0) !important;
}
.delete-whiteboard-dialog.dark .delete-whiteboard-dialog__confirm:hover:not(:disabled) {
  background-color: oklch(0.45 0.2 25) !important;
  border-color: oklch(0.45 0.2 25) !important;
  color: oklch(0.985 0 0) !important;
}
.delete-whiteboard-dialog.dark > button {
  color: oklch(0.985 0 0) !important;
}
.delete-whiteboard-dialog.dark > button:hover {
  opacity: 1;
}

.whiteboard-canvas {
  display: block;
  width: 100%;
  height: 100%;
  color: var(--muted-foreground);
}

.whiteboard-text-edit {
  overflow: visible;
}

.whiteboard-text-display {
  width: 100%;
  height: 100%;
  color: var(--muted-foreground);
  font-size: 16px;
  line-height: 16px;
  font-family: inherit;
  box-sizing: border-box;
  white-space: pre;
  background: transparent;
  border: none;
}

/* Underline always matches text color (color span wraps format tags so currentColor works). */
.whiteboard-text-display u {
  text-decoration-color: currentColor;
  text-decoration-line: underline;
}

.whiteboard-text-display.whiteboard-text-display--fit {
  width: fit-content;
  max-width: 100%;
  height: fit-content;
  min-height: 1em;
}

.whiteboard-text-display.whiteboard-text-display--sized {
  box-sizing: border-box;
  padding: 2px;
}

.whiteboard-text-display:focus {
  outline: none;
}
